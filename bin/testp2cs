#!/bin/bash
#
# Run testp2c on all sample programs that have both .inp and .cmp files.
#
# Must be run from the sample_programs directory.
#

pass=0
fail=0
total=0
export P2C_RESULTS=$(mktemp)

for inp in *.inp; do
    prog=${inp%.inp}
    if [ -f "${prog}.pas" ] && [ -f "${prog}.cmp" ]; then
        total=$((total + 1))
        echo "========================================"
        ../bin/testp2c $prog
        if [ $? -eq 0 ]; then
            pass=$((pass + 1))
        else
            fail=$((fail + 1))
        fi
        echo ""
    fi
done

echo "========================================"
printf "%-12s %-10s %-10s %s\n" "Program" "p2c" "gcc" "dif"
echo "----------------------------------------"
cat "$P2C_RESULTS"
echo "----------------------------------------"
echo "Results: $pass passed, $fail failed, $total total"
rm -f "$P2C_RESULTS"
