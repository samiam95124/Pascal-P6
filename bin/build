#!/bin/bash
#
# General build script for Pascal-P6
#
# Form:
# 
# build [<options for make>] [<options for pc>]
#
# Note: if you want to give multiple options for make or pc, surround in quotes
# like:
#
# build "-Bi" "-r -d"
#
function compprog {

   pc $1 $OPTIONS
   if [ $? -ne 0 ]; then

      echo "*** Error: compile failed"
      exit 1

   fi
   cp $1 bin

}

OPTIONS=$2

make clean
make $1
if [ $? -ne 0 ]; then

   echo "*** Error: make failed"
   exit 1

fi

#
# Services is build from C level components.
# We build an interpretive deck here only as a dummy to satisfy
# pc builds.
#
pc libs/source/services -pint
cp libs/source/services.p6 libs

#
# General library modules in Pascaline.
# These are compiled to objects and intermediates both because they can be used
# in executables and interpretation.
#
pc libs/source/strings
cp libs/source/strings.o libs
pc libs/source/strings -pint
cp libs/source/strings.p6 libs

pc libs/source/parse
cp libs/source/parse.o libs
pc libs/source/parse -pint
cp libs/source/parse.p6 libs

#
# Programs in Pascaline.
#
compprog pc/pc
compprog pc/hashtabr
compprog pc/hashtabs
compprog source/genobj
compprog libs/tests/strtst
compprog libs/tests/services_test
compprog libs/tests/services_test1
compprog source/pcom
compprog source/pint
compprog source/pmach
compprog source/pgen/pgen
